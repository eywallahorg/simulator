<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Eywallah Sim</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #111; color: white; }
    #loginScreen, #gameScreen { display: none; }
    #loginScreen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
    input { margin: 5px; padding: 10px; width: 200px; }
    button { padding: 10px 20px; cursor: pointer; }
    #hud { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 8px; }
    #eventBox { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; display: none; }
    canvas { display: block; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <h1>Eywallah Sim ðŸ”‘</h1>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Åžifre">
    <button onclick="login()">GiriÅŸ Yap</button>
    <button onclick="register()">KayÄ±t Ol</button>
    <p id="loginMsg"></p>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen">
    <div id="hud">
      <p>ðŸ’° Para: <span id="money">500</span></p>
      <p>ðŸŽ‚ YaÅŸ: <span id="age">15</span></p>
      <p>ðŸ§  Stres: <span id="stress">20</span></p>
    </div>
    <div id="eventBox">
      <p id="eventText">Olay geliyor...</p>
      <button onclick="chooseOption(1)">SeÃ§enek 1</button>
      <button onclick="chooseOption(2)">SeÃ§enek 2</button>
    </div>
    <canvas id="gameCanvas"></canvas>
  </div>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¥ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDdkE1j3ClDiNwZLobg09MRpH-vGLQJv-s",
      authDomain: "eywallahsimulator.firebaseapp.com",
      projectId: "eywallahsimulator",
      storageBucket: "eywallahsimulator.firebasestorage.app",
      messagingSenderId: "734785567506",
      appId: "1:734785567506:web:1ebdba4ac2e37b907991cb",
      measurementId: "G-86GQX5G1S3"
    };

    // BaÅŸlat
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let gameData = { money: 500, age: 15, stress: 20 };

    // Login/Register
    async function login() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      try {
        const user = await auth.signInWithEmailAndPassword(email, pass);
        currentUser = user.user;
        await loadGameData();
        startGame();
      } catch (e) {
        document.getElementById("loginMsg").innerText = "Hata: " + e.message;
      }
    }

    async function register() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      try {
        const user = await auth.createUserWithEmailAndPassword(email, pass);
        currentUser = user.user;
        await saveGameData();
        startGame();
      } catch (e) {
        document.getElementById("loginMsg").innerText = "Hata: " + e.message;
      }
    }

    async function saveGameData() {
      if (!currentUser) return;
      await db.collection("users").doc(currentUser.uid).set(gameData);
    }

    async function loadGameData() {
      if (!currentUser) return;
      const snap = await db.collection("users").doc(currentUser.uid).get();
      if (snap.exists) {
        gameData = snap.data();
      }
    }

    function startGame() {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("gameScreen").style.display = "block";
      updateHUD();
      initScene();
      setInterval(randomEvent, 15000);
    }

    function updateHUD() {
      document.getElementById("money").innerText = gameData.money;
      document.getElementById("age").innerText = gameData.age;
      document.getElementById("stress").innerText = gameData.stress;
      saveGameData();
    }

    function randomEvent() {
      let events = [
        { text: "ArkadaÅŸÄ±n sinemaya Ã§aÄŸÄ±rdÄ±", opt1: "Git (Mutluluk +)", opt2: "Gitme (Stres -)" },
        { text: "Kumar fÄ±rsatÄ±! (20+ yaÅŸ iÃ§in)", opt1: "Oyna (Riskli)", opt2: "Reddet (GÃ¼venli)" },
        { text: "Ev fiyatlarÄ± arttÄ±, satacak mÄ±sÄ±n?", opt1: "Sat (Para +)", opt2: "Bekle (Risk)" }
      ];
      let e = events[Math.floor(Math.random() * events.length)];
      if (e.text.includes("Kumar") && gameData.age < 20) return;
      document.getElementById("eventBox").style.display = "block";
      document.getElementById("eventText").innerText = e.text;
      document.querySelectorAll("#eventBox button")[0].innerText = e.opt1;
      document.querySelectorAll("#eventBox button")[1].innerText = e.opt2;
    }

    function chooseOption(opt) {
      if (opt === 1) gameData.money += 100;
      else gameData.stress -= 5;
      document.getElementById("eventBox").style.display = "none";
      updateHUD();
    }

    // Three.js Harita
    function initScene() {
      const canvas = document.getElementById("gameCanvas");
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({ canvas });
      renderer.setSize(window.innerWidth, window.innerHeight);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 10, 5).normalize();
      scene.add(light);

      for (let i = 0; i < 20; i++) {
        let geometry = new THREE.BoxGeometry(1, Math.random()*3+1, 1);
        let material = new THREE.MeshStandardMaterial({ color: Math.random()*0xffffff });
        let cube = new THREE.Mesh(geometry, material);
        cube.position.set(Math.random()*20-10, cube.geometry.parameters.height/2, Math.random()*20-10);
        scene.add(cube);
      }

      camera.position.z = 15;
      camera.position.y = 10;
      camera.lookAt(0,0,0);

      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
    }
  </script>
</body>
</html>
