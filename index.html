<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Eywallah Sim</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #111; color: white; }
    #loginScreen, #gameScreen { display: none; }
    #loginScreen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
    input { margin: 5px; padding: 10px; width: 200px; }
    button { padding: 10px 20px; cursor: pointer; margin: 5px; }
    #hud { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 8px; }
    #eventBox { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; display: none; }
    canvas { display: block; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <h1>Eywallah Sim ðŸ”‘</h1>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Åžifre">
    <div>
      <button onclick="login()">GiriÅŸ Yap</button>
      <button onclick="register()">KayÄ±t Ol</button>
    </div>
    <p id="loginMsg" style="color: yellow;"></p>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen">
    <div id="hud">
      <p>ðŸ’° Para: <span id="money">500</span></p>
      <p>ðŸŽ‚ YaÅŸ: <span id="age">15</span></p>
      <p>ðŸ§  Stres: <span id="stress">20</span></p>
    </div>
    <div id="eventBox">
      <p id="eventText">Olay geliyor...</p>
      <button onclick="chooseOption(1)">SeÃ§enek 1</button>
      <button onclick="chooseOption(2)">SeÃ§enek 2</button>
    </div>
    <canvas id="gameCanvas"></canvas>
  </div>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.module.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase Config (GitHub Pages ile uyumlu)
    const firebaseConfig = {
      apiKey: "AIzaSyDdkE1j3ClDiNwZLobg09MRpH-vGLQJv-s",
      authDomain: "eywallahsimulator.firebaseapp.com",
      projectId: "eywallahsimulator",
      storageBucket: "eywallahsimulator.appspot.com",
      messagingSenderId: "734785567506",
      appId: "1:734785567506:web:1ebdba4ac2e37b907991cb",
      measurementId: "G-86GQX5G1S3"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;
    let gameData = { money: 500, age: 15, stress: 20 };

    // LOGIN
    async function login() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      try {
        const user = await signInWithEmailAndPassword(auth, email, pass);
        currentUser = user.user;
        await loadGameData();
        startGame();
      } catch (err) {
        document.getElementById("loginMsg").innerText = "Hata: " + err.message;
      }
    }

    // REGISTER
    async function register() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      try {
        const user = await createUserWithEmailAndPassword(auth, email, pass);
        currentUser = user.user;
        await saveGameData();
        startGame();
      } catch (err) {
        document.getElementById("loginMsg").innerText = "Hata: " + err.message;
      }
    }

    // SAVE DATA
    async function saveGameData() {
      if (!currentUser) return;
      await setDoc(doc(db, "users", currentUser.uid), gameData);
    }

    // LOAD DATA
    async function loadGameData() {
      if (!currentUser) return;
      const ref = doc(db, "users", currentUser.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) gameData = snap.data();
    }

    function startGame() {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("gameScreen").style.display = "block";
      updateHUD();
      initScene();
      setInterval(randomEvent, 15000);
    }

    function updateHUD() {
      document.getElementById("money").innerText = gameData.money;
      document.getElementById("age").innerText = gameData.age;
      document.getElementById("stress").innerText = gameData.stress;
      saveGameData();
    }

    // RANDOM EVENTS
    function randomEvent() {
      const events = [
        { text: "ArkadaÅŸÄ±n sinemaya Ã§aÄŸÄ±rdÄ±", opt1: "Git (Mutluluk +)", opt2: "Gitme (Stres -)" },
        { text: "Kumar fÄ±rsatÄ±! (20+ yaÅŸ iÃ§in)", opt1: "Oyna (Riskli)", opt2: "Reddet (GÃ¼venli)" },
        { text: "Ev fiyatlarÄ± arttÄ±, satacak mÄ±sÄ±n?", opt1: "Sat (Para +)", opt2: "Bekle (Risk)" }
      ];
      let e = events[Math.floor(Math.random() * events.length)];
      if (e.text.includes("Kumar") && gameData.age < 20) return;
      document.getElementById("eventBox").style.display = "block";
      document.getElementById("eventText").innerText = e.text;
      document.querySelectorAll("#eventBox button")[0].innerText = e.opt1;
      document.querySelectorAll("#eventBox button")[1].innerText = e.opt2;
    }

    function chooseOption(opt) {
      if (opt === 1) gameData.money += 100;
      else gameData.stress -= 5;
      document.getElementById("eventBox").style.display = "none";
      updateHUD();
    }

    // SIMPLE THREE.JS MAP
    function initScene() {
      const canvas = document.getElementById("gameCanvas");
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({ canvas });
      renderer.setSize(window.innerWidth, window.innerHeight);

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 10, 5).normalize();
      scene.add(light);

      for (let i=0;i<30;i++){
        const geometry = new THREE.BoxGeometry(1, Math.random()*3+1, 1);
        const material = new THREE.MeshStandardMaterial({ color: Math.random()*0xffffff });
        const cube = new THREE.Mesh(geometry, material);
        cube.position.set(Math.random()*40-20, cube.geometry.parameters.height/2, Math.random()*40-20);
        scene.add(cube);
      }

      camera.position.z = 25;
      camera.position.y = 15;
      camera.lookAt(0,0,0);

      function animate() { requestAnimationFrame(animate); renderer.render(scene, camera); }
      animate();
    }
  </script>
</body>
</html>
